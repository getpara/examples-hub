name: Flutter E2E Tests (On Demand)

on:
  workflow_dispatch:
    inputs:
      flutter-sdk-branch:
        description: 'Flutter SDK branch to test against (leave empty for current pubspec.yaml)'
        required: false
        type: string
        default: ''
      test-filter:
        description: 'Test filter (e.g., "email", "phone", "all")'
        required: false
        type: string
        default: 'all'

jobs:
  flutter-e2e-manual:
    uses: ./.github/workflows/flutter-e2e-shared.yml
    with:
      working-directory: 'mobile/with-flutter'
      flutter-sdk-override: ${{ inputs.flutter-sdk-branch }}
    secrets:
      PARA_API_KEY: ${{ secrets.PARA_API_KEY }}
      
  test-summary:
    needs: flutter-e2e-manual
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: Test Summary
        run: |
          echo "## 🧪 Flutter E2E Test Summary"
          echo "**Flutter SDK Branch:** ${{ inputs.flutter-sdk-branch || 'default (pubspec.yaml)' }}"
          echo "**Test Filter:** ${{ inputs.test-filter }}"
          echo "**Status:** ${{ needs.flutter-e2e-manual.result }}"
          
          if [ "${{ needs.flutter-e2e-manual.result }}" == "success" ]; then
            echo "✅ All tests passed!"
          else
            echo "❌ Tests failed. Check the artifacts for details."
          fi